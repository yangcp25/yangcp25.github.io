+++
date = '2025-08-15T09:14:46+08:00'
draft = true
title = '超卖'
+++
### 如何解决商品超卖
#### 1.设计数据字段为无符号整型
兜底设置，如果发生超卖，字段被设置成负数会抛出异常
#### 2.数据库悲观锁
使用innodb的行锁，一个事务如果加上写锁，其他事务需要等待这个写锁在事务结束提交或者回滚之后才能获取到读写权限.
#### 3.数据库乐观锁
乐观的认为不会发生竞态问题，需要加上一个版本号，每次修改都会修改版本号，在更新前判断版本号是否一致，如果一致才更新，
否则进行重试，优点是无锁，缺点是需要重试机制。
#### 4.redis 队列
#### 5.redis lua脚本
#### 6.一锁二查三确定
#### 7.消息队列
#### 8.分布式锁