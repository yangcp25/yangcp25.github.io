+++
date = '2025-08-08T09:50:22+08:00'
draft = false
title = 'ddd领域驱动设计'
+++
### 什么是DDD?
DDD是domain design driver 的简称，根本的目的是为了解决软件的复杂性的一种设计思想。传统的MVC等代码、软件架构是面向程序员工程师的，而
产品经理更多只是需求产品设计，这导致软件架构和实际的业务脱离，当业务变得复杂，软件复杂性提高之后，后续的维护升级重构会遭遇重重困难。
### 关键概念
#### 充血模型and贫血模型
贫血模型是为了引出充血模型这一概念。贫血模型是指我们通常的数据库映射只有属性，而没有表现出具体的业务属性，也就是没有
引起映射数据变化的方法，就看不出来这个映射具体的业务，DDD的建议是把能引发变化的方法都写到这个变化内，这样别人一看就知道这个
实体具体包含了哪些业务属性。
#### 聚合根
#### 防腐层
### 我的理解
整个DDD架构里面遵循了设计原则的最佳实践，比如高内聚低耦合这个大的思想，以及一些设计原则
1. 单一职责,一个方法、类、模块只干一件事情
2. 开放封闭，对扩展开放，对修改封闭
3. 依赖倒置，依赖于接口而不是具体实现。
4. 接口隔离，接口小而精，不是胖而杂
5. 里氏替换，对继承的补充，一个子类要能够完全替换父类，也就是要遵循父类的约定，这样少破坏原有的约定。
6. 迪米洛法则（最少知识原则），不要跨多个对象调用方法，不需要知道跨对象的内部细节，只调用最新的朋友节点
### 战术构件和战略构件
DDD是一套架构思想方法论，它为代码层面和架构层面都提供了对应的构件帮我我们设计构架。
#### 战术构件（代码层面）
1. 实体
2. 值对象
3. 根/聚合根
4. repository
5. domain
6. 工厂
7. 事件
#### 战略构件（架构层面）
1. 界限上下文（模块）
2. 通用语言（业务和技术用同一种专业术语沟通，防止鸡同鸭讲）
3. 上下文映射（模块之间如何关联）
### 实际架构示例
                ┌──────────────────────────────────────────────┐
                │                战略构件 (Strategic)           │
                │----------------------------------------------│
                │  限界上下文 (Bounded Contexts)                │
                │    ├── 用户上下文 (User Context)              │
                │    ├── 订单上下文 (Order Context)             │
                │    ├── 商品上下文 (Product Context)           │
                │    └── 支付上下文 (Payment Context)           │
                │                                              │
                │  上下文映射 (Context Map)                     │
                │    ├── 上下游 (Upstream/Downstream)           │
                │    ├── 防腐层 (ACL)                          │
                │    ├── 合作伙伴 (Partnership)                 │
                │    └── 开放主机服务 (OHS)                    │
                │                                              │
                │  通用语言 (Ubiquitous Language)               │
                │    └── "订单"、"支付单"、"退款单"             │
                └──────────────────────────────────────────────┘

                                    │
                                    ▼

                ┌──────────────────────────────────────────────┐
                │                战术构件 (Tactical)            │
                │----------------------------------------------│
                │  接口层 (Interface Layer)                    │
                │    └── Kratos Handler (HTTP/gRPC 接口)       │
                │                                              │
                │  应用层 (Application Layer)                  │
                │    └── 应用服务 (Application Service)        │
                │         → OrderUsecase                      │
                │                                              │
                │  领域层 (Domain Layer)                       │
                │    ├── 实体 (Entity) & 聚合根 (AggregateRoot) │
                │    │      → Order, OrderItem                 │
                │    ├── 值对象 (Value Object)                 │
                │    │      → Money, Address                   │
                │    ├── 领域服务 (Domain Service)             │
                │    │      → PaymentService                   │
                │    ├── 工厂 (Factory)                        │
                │    │      → NewOrder                         │
                │    ├── 领域事件 (Domain Event)               │
                │    │      → OrderPaidEvent                   │
                │    └── 仓储接口 (Repository Interface)        │
                │                                              │
                │  基础设施层 (Infrastructure Layer)            │
                │    └── 仓储实现 (Repository Impl, GORM)      │
                │         → orderRepo (MySQL)                  │
                └──────────────────────────────────────────────┘

### kratos 和DDD  架构对照

| Kratos 层级    | DDD 层级               | 作用                                          |
|--------------|----------------------|---------------------------------------------|
| **service/** | Interface / Adapter  | gRPC/HTTP Handler，参数验证/响应封装，调用 UseCase      |
| **biz/**     | Domain + Application | 业务逻辑和领域规则处理，UseCase（业务服务），纯业务计算             |
| **data/**    | Infrastructure       | 数据库、缓存、第三方 SDK 封装，实现 Repository 接口，提供外部依赖能力 |
| **pkg/**     | Infrastructure（共享组件） | 可复用 SDK 封装、工具函数、通用库，跨服务共享                   |

### 参考资料

1. **美团** [领域驱动设计在互联网业务开发中的实践](https://tech.meituan.com/2017/12/22/ddd-in-practice.html)