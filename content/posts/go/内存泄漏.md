+++
date = '2025-08-01T09:10:55+08:00'
title = '内存泄漏'
draft = false
tag = ['go', '内存泄漏']
+++
### 什么是内存泄漏
指内存资源长期得不到释放，导致内存溢出
### 内存泄漏的常见场景
1. 协程的泄漏
   1. 耗时任务或者http请求一直得不到响应，又没有设置超时时间
   2. chan未正确关闭、阻塞。range channel 发送端未关闭导致死循环。
   3. 锁未正确释放、导致协程未能释放
2. 资源未关闭，如file、数据库连接、timer定时器
3. cgo
4. 其他的一些
### 内存泄漏分析工具
pprof分析协程数量，内存占用情况等
### 如何针对内存泄漏进行优化
1. 针对协程泄漏
   1. 设置超时时间 context.deadline timeout 结合select进行超时控制
   2. 正确使用channel
   3. 正确使用互斥锁，配对使用 
   4. 针对channel的泄漏
      1. 配对使用
      2. 在发送方关闭channel
      3. 正确使用缓冲channel和非缓冲channel
2. 养成关闭资源的习惯，使用defer,clear up 等工具
3. cgo和其他场景记得防止协程泄漏