+++
date = '2025-09-20T09:44:15+08:00'
draft = false
title = 'GMP'
+++
### 什么是GMP
#### 概念
GMP是go的协程调度模型，go代码的程序有运行时runtime进行调度，go可以通过运行时进行内存的分配，通过channel进行协程间通信，通过go关键字创建协程。
而GMP正是协程调度的核心。
1. G代表go的goroutine,协程是用户态的轻量级线程，创建销毁的成本非常小，只需要大约2kb，而线程则需要2m,所以go的协程非常适合处理IO密集型任务。
2. M代表系统级线程，go的协程并不真正执行代码，它需要将协程调度到和内核绑定的系统级线程上进行实际的运行。
3. P代表逻辑处理单元，包含了待运行的协程和一些上下文。p又可以分为本地队列和全局队列。
#### 调度过程
![deepseek_mermaid_20250924_bc3c19.png](../../../static/images/deepseek_mermaid_20250924_bc3c19.png)
go的程序通过runtime创建协程
1. 将协程放到本地队列p
2. p和m绑定
3. m在操作系统上执行
#### 核心调度时机
1. 用户态态阻塞，比如channel、mutex，这个时候p会和m脱离，p会放入到待运行队列，或者重新绑定其他m
2. 内核态阻塞，比如发生了系统调用，io操作等，m会被标记成阻塞状态，go会重新创建后者唤醒一个m，保证并发度
#### 其他核心概念
1. ruetime.GOMAXPROCS()
#### 优化手段