+++
date = '2025-08-01T09:19:46+08:00'
draft = true
title = '数据粘包'
tag = ['network', 'tcp', '数据粘包']
+++
### 现象、产生的问题
TCP是基于流式传输的，它保证可靠性和顺序性不保证数据边界问题，需要应用层自己处理边界问题。各种情况会导致多个数据包被发送
到接收方。
#### 产生的场景
* 发送过程当中为了提高传输效率会将多个数据打包成传输层的数据段发送，接受放需要自己处理数据边界问题。
* 当接受放缓冲区的大小超过包大小或者出现网络阻塞和拥塞控制时，都会导致接收方缓冲器存放多个数据包
### 解决办法
* 关闭nagel算法，固定长度传输
* 自定义数据边界，比如`\0 \n\r`
* 在头部加入每次发送的数据大小
* tlv格式，比如protobuf就采用这种方式，t代表type,l代表长度，v代表数据
#### http是如何解决数据粘包的
* http1.0每次传输完成后会关闭tcp连接
* 每次明确发送的数据大小
* 定义发送的边界\0。