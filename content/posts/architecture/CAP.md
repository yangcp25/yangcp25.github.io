+++
date = '2025-07-16T09:21:40+08:00'
draft = false
title = 'CAP'
[cover]
image = "/images/cap.png"  # 路径基于 /static/
relative = true
+++
### 定义
CAP理论是指分布式当中一致性、可用性以及分区容错性三者不可兼得。我们需要根据实际应用场景做出相应的取舍，
其中在现实中，分布式系统中的网络是不可能完全保证可用的，所以就需要在CP和AP中做出选择。
#### raft协议
raft协议是分布式系统中对于某个资源的一致性的达成所采用的一种协议，主要有三个部分：
1. master选择
2. 日志复制
3. 安全性和一致性保证
需要注意的是raft协议不是强一致的。如果需要强一致，我们一般采用zookeeper.
#### zookeeper

### 实践
#### 常见的使用场景
一些常见的开源软件的使用我们会经常遇到这个场景。拿最常见的redis为例，redis的分布式部署方案有三种，主从、哨兵、cluster。
### 注意事项
这个理论提醒我们在分布式系统中需要根据具体的需求做出取舍。
#### redis分布式锁在分布式部署情况下的问题
简单来说需要把所有锁操作限定到一个槽里面，其次可以使用开源的解决方案比如redLock,以及优秀的redis客户端在发生key在其他节点会自动帮助我们
处理move操作
### 参考资料
1. **维基百科编者**. [CAP定理](https://zh.wikipedia.org/wiki/CAP定理). *维基百科*. 最后修订于2023年11月9日. 访问于2025年7月16日.
1. **CNBLOG**. [ZooKeeper 是什么](https://www.cnblogs.com/jiusibuiu/p/14210257.html). *维基百科*. 最后修订于2020-12-30 10:53. 访问于2025年7月20日.
